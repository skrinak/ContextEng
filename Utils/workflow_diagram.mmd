%% AI-Assisted Development Workflow
%% This Mermaid diagram shows the complete workflow from PRD to deployment
%% Edit this file manually to adjust layout and positioning

graph TB
    %% Phase 1: PRD Development
    subgraph phase1["Phase 1: PRD Development (PRD_DevelopmentPrompt.md)"]
        direction LR
        start([Start:<br/>Project Concept]):::purple
        round1[Round 1:<br/>Foundation<br/>(Personas, AWS)]:::red
        round2[Round 2:<br/>Technical Deep Dive<br/>(Infrastructure, APIs)]:::red
        round3[Round 3:<br/>Implementation<br/>(Deployment, Testing)]:::red
        round4[Round 4:<br/>Claude Optimization<br/>(Task Decomposition)]:::red
        prd_output[/PRD.md<br/>(Complete)/]:::green
        stakeholder{{Stakeholder<br/>Consultation}}:::orange

        start --> |Begin| round1
        round1 --> |Iterate| round2
        round2 --> |Refine| round3
        round3 --> |Optimize| round4
        round4 --> |Output| prd_output
        stakeholder -.->|Feedback| round1
        round4 -.->|Days of<br/>Refinement| stakeholder
    end

    %% Phase 2: Task Generation
    subgraph phase2["Phase 2: Task Generation (Task List Generator.md)"]
        direction LR
        task_input[/Input:<br/>PRD.md/]:::green
        analyze[Analyze<br/>Requirements]:::violet
        decompose[Decompose into<br/>Hierarchical Tasks]:::violet
        dependencies[Map Dependencies<br/>& Parallel Work]:::violet
        verification[Add Verification<br/>Criteria]:::violet
        tasks_output[/tasks.md<br/>[pending]<br/>Hierarchical/]:::green

        task_input --> analyze
        analyze --> decompose
        decompose --> dependencies
        dependencies --> verification
        verification --> |Generate| tasks_output
    end

    %% Phase 3: Iterative Development
    subgraph phase3["Phase 3: Iterative Development (Claude Code Agent)"]
        direction LR
        clear_context[/clear<br/>Reset Context]:::teal
        load_foundation[/Load Foundation:<br/>CLAUDE.md<br/>README.md<br/>.env/]:::teal
        read_tasks[/Read:<br/>tasks.md/]:::teal
        select_task[Select Task(s)<br/>from tasks.md]:::cyan
        mark_progress[Mark<br/>[in-progress]]:::cyan
        execute_parallel([Execute Tasks<br/>(Parallel when<br/>independent)]):::blue
        execute_serial[Execute Task<br/>(Serial when<br/>dependent)]:::blue
        mark_complete[Mark<br/>[completed]]:::cyan
        phase_complete{Phase<br/>Complete?}:::orange
        refresh_needed{Context<br/>Refresh<br/>Needed?}:::orange

        clear_context --> load_foundation
        load_foundation --> read_tasks
        read_tasks --> select_task
        select_task --> mark_progress
        mark_progress --> |Independent| execute_parallel
        execute_parallel --> |Dependent| execute_serial
        execute_serial --> mark_complete
        mark_complete --> phase_complete
        phase_complete --> |More Tasks| refresh_needed
        refresh_needed -.->|Yes<br/>(Complex/Errors)| clear_context
        refresh_needed -.->|No (Simple)| select_task
    end

    %% Completion
    subgraph completion["Completion"]
        direction LR
        verify_all[Verify:<br/>All Tasks<br/>[completed]]:::lightgreen
        deploy[Deploy:<br/>./deploy-alpha.sh]:::lightgreen
        success([Success:<br/>Project Complete]):::green

        verify_all --> deploy
        deploy --> success
    end

    %% Inter-phase connections
    prd_output ==> |Feed PRD| task_input
    tasks_output ==> |Start Dev| clear_context
    phase_complete ==> |All Phases<br/>Complete| verify_all

    %% Memory Management Protocol (separate)
    subgraph memory["Memory Management Protocol"]
        memory_protocol["<b>Context Commands:</b><br/>/clear - Reset context<br/>/context - View current<br/>/compact - Compress<br/>/resume - Continue<br/><br/><b>When to Refresh:</b><br/>• After each phase<br/>• Within phase (complex)<br/>• On errors/rate limits<br/>• Context > 80%<br/><br/>39% Performance Boost"]:::memory
    end

    %% Styling
    classDef purple fill:#A23B72,stroke:#A23B72,color:#fff,stroke-width:2px
    classDef red fill:#C73E1D,stroke:#C73E1D,color:#fff,stroke-width:2px
    classDef orange fill:#F18F01,stroke:#F18F01,color:#fff,stroke-width:2px
    classDef green fill:#6A994E,stroke:#6A994E,color:#fff,stroke-width:2px
    classDef violet fill:#560BAD,stroke:#560BAD,color:#fff,stroke-width:2px
    classDef teal fill:#048A81,stroke:#048A81,color:#fff,stroke-width:2px
    classDef cyan fill:#06A77D,stroke:#06A77D,color:#fff,stroke-width:2px
    classDef blue fill:#05668D,stroke:#05668D,color:#fff,stroke-width:2px
    classDef lightgreen fill:#52B788,stroke:#52B788,color:#fff,stroke-width:2px
    classDef memory fill:#FFF9E3,stroke:#A23B72,color:#333,stroke-width:2px,stroke-dasharray:5

    %% Subgraph styling
    style phase1 fill:#E1F5FF,stroke:#2E86AB,stroke-width:3px
    style phase2 fill:#F3E5F5,stroke:#7209B7,stroke-width:3px
    style phase3 fill:#E0F2F1,stroke:#06A77D,stroke-width:3px
    style completion fill:#E8F5E9,stroke:#6A994E,stroke-width:3px
    style memory fill:#FFF9E3,stroke:#A23B72,stroke-width:2px,stroke-dasharray:10
